div(*ngIf="cache.loaded", class="w-full h-full overflow-hidden", [ngClass]="containerClass()")
    div(class="w-full h-full overflow-hidden", [ngClass]="issue.modal ? 'lg:pt-7' : ''")
        div(class="overflow-hidden bg-white", [ngClass]="(issue.modal ? 'mx-auto lg:rounded-xl max-w-screen-2xl w-5/4 h-full lg:h-[90vh]' : 'w-full h-full') + (issue.id == 'new' ? ' max-w-[840px]' : '')", role="document", '#body'='')
            div(class="w-full h-full overflow-hidden flex flex-col", [class.modal-content]="issue.modal")
                //- 헤더
                div(class="flex items-center px-4 py-3 border-b border-neutral-200 h-14 shrink-0 gap-3")
                    input(class="flex-1 border-0 shadow-none outline-none text-base font-semibold text-neutral-900 placeholder-neutral-400", [(ngModel)]="data.info.title", placeholder="이슈 제목을 입력해주세요", [disabled]="!isRole(['owner', 'manager'])")
                    div(class="flex items-center gap-2")
                        button(class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors", (click)="update()", *ngIf="!readOnly && isRole(['owner', 'manager'])")
                            span 저장하기
                            wiz-component-spinner(class="ml-1", *ngIf="cache.isUpdate")
                        button(class="hidden lg:flex items-center justify-center size-8 rounded-md text-neutral-400 hover:bg-neutral-100 hover:text-neutral-600 transition-colors movable-btn", (mousedown)="onStartMoving($event)", (mouseup)="onStopMoving($event)", *ngIf="isMovable")
                            i(class="ti ti-arrows-move text-lg")
                        button(class="flex items-center justify-center size-8 rounded-md text-neutral-400 hover:bg-neutral-100 hover:text-neutral-600 transition-colors", (click)="hide()")
                            i(class="ti ti-x text-lg")

                //- 모바일 탭 전환
                div(class="hidden max-sm:!flex border-b border-neutral-200")
                    a(class="flex-1 text-center py-2.5 text-sm transition-colors cursor-pointer", (click)="switchTab('info')", [ngClass]="cache.tab == 'info' ? 'border-b-2 border-neutral-900 text-neutral-900 font-medium -mb-px' : 'text-neutral-500 hover:text-neutral-700'")
                        span 작업정보
                        i(class="ti ti-file-text ml-2 text-base")
                    a(class="flex-1 text-center py-2.5 text-sm transition-colors cursor-pointer", (click)="switchTab('message')", [ngClass]="cache.tab == 'message' ? 'border-b-2 border-neutral-900 text-neutral-900 font-medium -mb-px' : 'text-neutral-500 hover:text-neutral-700'")
                        span 메시지
                        i(class="ti ti-message ml-2 text-base")

                //- 메인 콘텐츠 영역
                div(class="flex-1 flex m-0 p-0 overflow-hidden")
                    //- 좌측 패널: 작업 정보
                    div(class="m-0 p-0 overflow-hidden max-sm:hidden h-full border-r border-neutral-200 flex flex-col bg-white", [ngClass]="(issue.id == 'new' ? 'w-full flex-1' : 'w-7/12 max-sm:w-full') + (cache.tab == 'info' ? ' max-sm:!flex' : '')")
                        div(class="p-5 h-full overflow-y-auto overflow-x-hidden text-sm pb-[360px] lg:pb-5")
                            div(class="space-y-4")
                                //- 이슈 제목
                                div(class="flex items-center")
                                    span(class="text-sm font-medium text-neutral-500 w-28 shrink-0") 이슈제목
                                    div(class="flex-1")
                                        input(class="w-full px-3 py-1.5 text-sm border border-neutral-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-400 placeholder-neutral-400 transition-colors", [(ngModel)]="data.info.title", [disabled]="!isRole(['owner', 'manager'])", placeholder="이슈 제목을 입력해주세요")

                                //- 프로젝트
                                div(class="flex items-center")
                                    span(class="text-sm font-medium text-neutral-500 w-28 shrink-0") 프로젝트
                                    div(class="flex-1")
                                        a(class="text-sm text-blue-600 hover:text-blue-700 transition-colors", routerLink="/project/{{project.data().namespace}}/issueboard") {{project.data().title}}

                                //- 요청자
                                div(class="flex items-center", *ngIf="project.member.map[data.info.user_id]")
                                    span(class="text-sm font-medium text-neutral-500 w-28 shrink-0") 요청자
                                    div(class="flex-1 flex items-center gap-1 text-sm text-neutral-700")
                                        span {{project.member.map[data.info.user_id].name}}
                                        small(class="text-neutral-400") ({{project.member.map[data.info.user_id].email}})

                                //- 작업자
                                div(class="flex items-start")
                                    span(class="text-sm font-medium text-neutral-500 w-28 shrink-0 pt-1") 작업자
                                    div(class="flex-1 flex flex-wrap items-center gap-1.5")
                                        ng-container(*ngFor="let worker of data.info.worker")
                                            button(class="inline-flex items-center gap-1 px-2 py-1 text-xs border border-neutral-200 rounded-md hover:border-neutral-300 transition-colors", (click)="removeMember(worker)", *ngIf="project.member.map[worker]")
                                                span {{project.member.map[worker].name}}
                                                i(class="ti ti-x text-sm text-red-400", *ngIf="!readOnly && isRole(['owner', 'manager'])")
                                        div(class="relative", *ngIf="!readOnly && isRole(['owner', 'manager'])")
                                            button(class="inline-flex items-center gap-1 px-2 py-1 text-xs border border-dashed border-neutral-300 rounded-md text-neutral-500 hover:border-neutral-400 hover:text-neutral-700 transition-colors", (click)="selectMember()")
                                                i(class="ti ti-plus text-sm")
                                                span 작업자 추가
                                            div(class="absolute top-full left-0 mt-2 bg-white border border-neutral-200 rounded-lg shadow-lg min-w-48 z-[1000]", *ngIf="cache.worker")
                                                div(class="p-2 border-b border-neutral-100")
                                                    input(class="w-full px-2.5 py-1.5 text-xs border border-neutral-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-400 placeholder-neutral-400", placeholder="사용자 검색", [(ngModel)]="cache.searchMember")
                                                ng-container(*ngFor="let member of project.member.list()")
                                                    div(class="px-3 py-2 text-sm text-neutral-700 cursor-pointer hover:bg-neutral-50 transition-colors", *ngIf="searchMember(member, cache.searchMember)", (click)="addMember(member.meta.id)")
                                                        span {{member.meta.name}}

                                //- 시작일
                                div(class="flex items-center")
                                    span(class="text-sm font-medium text-neutral-500 w-28 shrink-0") 시작일
                                    div(class="flex-1")
                                        input(type="date", class="px-3 py-1.5 text-sm border border-neutral-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-400 transition-colors", [(ngModel)]="data.info.planstart", [disabled]="!isRole(['owner', 'manager'])")

                                //- 종료일
                                div(class="flex items-center")
                                    span(class="text-sm font-medium text-neutral-500 w-28 shrink-0") 종료일
                                    div(class="flex-1")
                                        input(type="date", class="px-3 py-1.5 text-sm border border-neutral-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-400 transition-colors", [(ngModel)]="data.info.planend", [disabled]="!isRole(['owner', 'manager'])")

                                //- 우선순위
                                div(class="flex items-center")
                                    span(class="text-sm font-medium text-neutral-500 w-28 shrink-0") 우선순위
                                    div(class="flex-1 flex flex-wrap items-center gap-1.5")
                                        label(class="cursor-pointer")
                                            input(type="radio", name="level", value=0, class="sr-only peer/level", [(ngModel)]="data.info.level", [disabled]="!isRole(['owner', 'manager'])")
                                            span(class="inline-flex items-center gap-1 px-2.5 py-1 text-xs rounded-md border border-neutral-200 text-neutral-500 transition-all whitespace-nowrap peer-checked/level:border-blue-400 peer-checked/level:bg-blue-50 peer-checked/level:text-blue-600 hover:bg-neutral-50")
                                                i(class="ti ti-circle-dot text-sm")
                                                span 낮음
                                        label(class="cursor-pointer")
                                            input(type="radio", name="level", value=1, class="sr-only peer/level", [(ngModel)]="data.info.level", [disabled]="!isRole(['owner', 'manager'])")
                                            span(class="inline-flex items-center gap-1 px-2.5 py-1 text-xs rounded-md border border-neutral-200 text-neutral-500 transition-all whitespace-nowrap peer-checked/level:border-blue-400 peer-checked/level:bg-blue-50 peer-checked/level:text-blue-600 hover:bg-neutral-50")
                                                i(class="ti ti-circle-filled text-sm")
                                                span 중간
                                        label(class="cursor-pointer")
                                            input(type="radio", name="level", value=2, class="sr-only peer/level", [(ngModel)]="data.info.level", [disabled]="!isRole(['owner', 'manager'])")
                                            span(class="inline-flex items-center gap-1 px-2.5 py-1 text-xs rounded-md border border-neutral-200 text-neutral-500 transition-all whitespace-nowrap peer-checked/level:border-blue-400 peer-checked/level:bg-blue-50 peer-checked/level:text-blue-600 hover:bg-neutral-50")
                                                i(class="ti ti-alert-circle text-sm")
                                                span 중요
                                        label(class="cursor-pointer")
                                            input(type="radio", name="level", value=3, class="sr-only peer/level", [(ngModel)]="data.info.level", [disabled]="!isRole(['owner', 'manager'])")
                                            span(class="inline-flex items-center gap-1 px-2.5 py-1 text-xs rounded-md border border-neutral-200 text-neutral-500 transition-all whitespace-nowrap peer-checked/level:border-blue-400 peer-checked/level:bg-blue-50 peer-checked/level:text-blue-600 hover:bg-neutral-50")
                                                i(class="ti ti-speakerphone text-sm")
                                                span 긴급

                                //- 진행상태
                                div(class="flex items-start")
                                    span(class="text-sm font-medium text-neutral-500 w-28 shrink-0 pt-1") 진행상태
                                    div(class="flex-1 flex flex-wrap items-center gap-1.5")
                                        label(class="cursor-pointer")
                                            input(type="radio", name="status", value="noti", class="sr-only peer/status", [(ngModel)]="data.info.status", [disabled]="!isRole(['owner', 'manager'])")
                                            span(class="inline-flex items-center gap-1 px-2.5 py-1 text-xs rounded-md border border-neutral-200 text-neutral-500 transition-all whitespace-nowrap peer-checked/status:border-blue-400 peer-checked/status:bg-blue-50 peer-checked/status:text-blue-600 hover:bg-neutral-50")
                                                i(class="ti ti-bell text-sm")
                                                span 공지/알림
                                        label(class="cursor-pointer")
                                            input(type="radio", name="status", value="event", class="sr-only peer/status", [(ngModel)]="data.info.status", [disabled]="!isRole(['owner', 'manager'])")
                                            span(class="inline-flex items-center gap-1 px-2.5 py-1 text-xs rounded-md border border-neutral-200 text-neutral-500 transition-all whitespace-nowrap peer-checked/status:border-blue-400 peer-checked/status:bg-blue-50 peer-checked/status:text-blue-600 hover:bg-neutral-50")
                                                i(class="ti ti-calendar text-sm")
                                                span 일정
                                        label(class="cursor-pointer")
                                            input(type="radio", name="status", value="open", class="sr-only peer/status", [(ngModel)]="data.info.status", [disabled]="!isRole(['owner', 'manager'])")
                                            span(class="inline-flex items-center gap-1 px-2.5 py-1 text-xs rounded-md border border-neutral-200 text-neutral-500 transition-all whitespace-nowrap peer-checked/status:border-blue-400 peer-checked/status:bg-blue-50 peer-checked/status:text-blue-600 hover:bg-neutral-50")
                                                i(class="ti ti-hourglass text-sm")
                                                span 시작되지 않음
                                        label(class="cursor-pointer")
                                            input(type="radio", name="status", value="work", class="sr-only peer/status", [(ngModel)]="data.info.status", [disabled]="!isRole(['owner', 'manager'])")
                                            span(class="inline-flex items-center gap-1 px-2.5 py-1 text-xs rounded-md border border-neutral-200 text-neutral-500 transition-all whitespace-nowrap peer-checked/status:border-blue-400 peer-checked/status:bg-blue-50 peer-checked/status:text-blue-600 hover:bg-neutral-50")
                                                i(class="ti ti-hourglass-half2 text-sm")
                                                span 진행
                                        label(class="cursor-pointer")
                                            input(type="radio", name="status", value="finish", class="sr-only peer/status", [(ngModel)]="data.info.status", [disabled]="!isRole(['owner', 'manager'])")
                                            span(class="inline-flex items-center gap-1 px-2.5 py-1 text-xs rounded-md border border-neutral-200 text-neutral-500 transition-all whitespace-nowrap peer-checked/status:border-blue-400 peer-checked/status:bg-blue-50 peer-checked/status:text-blue-600 hover:bg-neutral-50")
                                                i(class="ti ti-hourglass-filled text-sm")
                                                span 완료
                                        label(class="cursor-pointer", *ngIf="isRole(['owner'])")
                                            input(type="radio", name="status", value="close", class="sr-only peer/status", [(ngModel)]="data.info.status", [disabled]="!isRole(['owner', 'manager'])")
                                            span(class="inline-flex items-center gap-1 px-2.5 py-1 text-xs rounded-md border border-neutral-200 text-neutral-500 transition-all whitespace-nowrap peer-checked/status:border-blue-400 peer-checked/status:bg-blue-50 peer-checked/status:text-blue-600 hover:bg-neutral-50")
                                                i(class="ti ti-circle-check text-sm")
                                                span 종료
                                        label(class="cursor-pointer", *ngIf="isRole(['owner'])")
                                            input(type="radio", name="status", value="cancel", class="sr-only peer/status", [(ngModel)]="data.info.status", [disabled]="!isRole(['owner', 'manager'])")
                                            span(class="inline-flex items-center gap-1 px-2.5 py-1 text-xs rounded-md border border-neutral-200 text-neutral-500 transition-all whitespace-nowrap peer-checked/status:border-blue-400 peer-checked/status:bg-blue-50 peer-checked/status:text-blue-600 hover:bg-neutral-50")
                                                i(class="ti ti-calendar-off text-sm")
                                                span 취소

                                //- 진행률
                                div(class="flex items-center")
                                    span(class="text-sm font-medium text-neutral-500 w-28 shrink-0") 진행률
                                    div(class="flex-1 flex flex-wrap items-center gap-1.5")
                                        label(class="cursor-pointer")
                                            input(type="radio", name="process", value=0, class="sr-only peer/process", [(ngModel)]="data.info.process", [disabled]="!isRole(['owner', 'manager'])")
                                            span(class="inline-flex items-center px-2.5 py-1 text-xs rounded-md border border-neutral-200 text-neutral-500 transition-all peer-checked/process:border-blue-400 peer-checked/process:bg-blue-50 peer-checked/process:text-blue-600 hover:bg-neutral-50") 0%
                                        label(class="cursor-pointer")
                                            input(type="radio", name="process", value=20, class="sr-only peer/process", [(ngModel)]="data.info.process", [disabled]="!isRole(['owner', 'manager'])")
                                            span(class="inline-flex items-center px-2.5 py-1 text-xs rounded-md border border-neutral-200 text-neutral-500 transition-all peer-checked/process:border-blue-400 peer-checked/process:bg-blue-50 peer-checked/process:text-blue-600 hover:bg-neutral-50") 20%
                                        label(class="cursor-pointer")
                                            input(type="radio", name="process", value=40, class="sr-only peer/process", [(ngModel)]="data.info.process", [disabled]="!isRole(['owner', 'manager'])")
                                            span(class="inline-flex items-center px-2.5 py-1 text-xs rounded-md border border-neutral-200 text-neutral-500 transition-all peer-checked/process:border-blue-400 peer-checked/process:bg-blue-50 peer-checked/process:text-blue-600 hover:bg-neutral-50") 40%
                                        label(class="cursor-pointer")
                                            input(type="radio", name="process", value=60, class="sr-only peer/process", [(ngModel)]="data.info.process", [disabled]="!isRole(['owner', 'manager'])")
                                            span(class="inline-flex items-center px-2.5 py-1 text-xs rounded-md border border-neutral-200 text-neutral-500 transition-all peer-checked/process:border-blue-400 peer-checked/process:bg-blue-50 peer-checked/process:text-blue-600 hover:bg-neutral-50") 60%
                                        label(class="cursor-pointer")
                                            input(type="radio", name="process", value=80, class="sr-only peer/process", [(ngModel)]="data.info.process", [disabled]="!isRole(['owner', 'manager'])")
                                            span(class="inline-flex items-center px-2.5 py-1 text-xs rounded-md border border-neutral-200 text-neutral-500 transition-all peer-checked/process:border-blue-400 peer-checked/process:bg-blue-50 peer-checked/process:text-blue-600 hover:bg-neutral-50") 80%
                                        label(class="cursor-pointer")
                                            input(type="radio", name="process", value=100, class="sr-only peer/process", [(ngModel)]="data.info.process", [disabled]="!isRole(['owner', 'manager'])")
                                            span(class="inline-flex items-center px-2.5 py-1 text-xs rounded-md border border-neutral-200 text-neutral-500 transition-all peer-checked/process:border-blue-400 peer-checked/process:bg-blue-50 peer-checked/process:text-blue-600 hover:bg-neutral-50") 100%

                                //- TODO
                                div(class="flex items-start", *ngIf="data.info.todo.length > 0 || isRole(['owner', 'manager'])")
                                    span(class="text-sm font-medium text-neutral-500 w-28 shrink-0 pt-2") TODO
                                    div(class="flex-1 border border-neutral-200 rounded-md overflow-hidden")
                                        ng-container(*ngIf="data.info.todo.length > 0")
                                            div([sortablejs]="data.info.todo", [sortablejsOptions]="config.todoSorted")
                                                div(class="flex items-center px-3 py-2 border-b border-neutral-100 hover:bg-neutral-50 transition-colors group", *ngFor="let todo of data.info.todo")
                                                    i(class="ti ti-check text-base px-1 cursor-pointer rounded", [ngClass]="todo.checked ? 'text-green-500' : 'text-neutral-400'", (click)="checkTodo(todo)")
                                                    div(class="flex-1", [class.text-green-600]="todo.checked")
                                                        input(class="w-full text-sm px-2 py-1 border-0 shadow-none focus:outline-none bg-transparent placeholder-neutral-400", [(ngModel)]="todo.title", placeholder="TODO 내용을 입력해주세요")
                                                    div(class="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity")
                                                        i(class="ti ti-arrows-move text-base text-neutral-400 cursor-move todo-handle")
                                                        i(class="ti ti-x text-base text-red-400 cursor-pointer hover:text-red-500 ml-1", *ngIf="!readOnly", (click)="removeTodo(todo)")
                                        div(class="flex items-center px-3 py-2", *ngIf="data.info.todo.length < 20 && isRole(['owner', 'manager'])", [ngClass]="data.info.todo.length > 0 ? 'border-t border-neutral-100' : ''")
                                            input(class="flex-1 text-sm px-2 py-1 border-0 shadow-none focus:outline-none bg-transparent placeholder-neutral-400", [(ngModel)]="cache.todoText", placeholder="TODO 내용을 입력해주세요", (keyup.enter)="addTodo(cache.todoText)")
                                            button(class="inline-flex items-center justify-center size-7 rounded-md bg-blue-500 text-white hover:bg-blue-600 transition-colors", (click)="addTodo(cache.todoText)")
                                                i(class="ti ti-plus text-sm")

                                //- 설명
                                div
                                    div(class="flex items-center mb-2")
                                        span(class="text-sm font-medium text-neutral-500") 설명
                                    div(class="ck-editor-auto ck-editor-works height-fit text-base prose max-w-full")
                                        textarea('#description'='', [attr.namespace]="NAMESPACE")

                    //- 우측 패널: 메시지
                    div(class="flex flex-col m-0 p-0 w-5/12 max-sm:hidden", *ngIf="issue.id != 'new'", [ngClass]="cache.tab == 'message' ? 'max-sm:!flex max-sm:w-full' : ''")
                        //- 메시지 탭
                        div(class="flex border-b border-neutral-200")
                            button(class="flex-1 py-2.5 text-sm transition-colors -mb-px", (click)="initMessage('message')", [ngClass]="cache.messageTab == 'message' ? 'border-b-2 border-neutral-900 text-neutral-900 font-medium' : 'text-neutral-500 hover:text-neutral-700'")
                                span 메시지
                            button(class="flex-1 py-2.5 text-sm transition-colors -mb-px", (click)="initMessage('log')", [ngClass]="cache.messageTab == 'log' ? 'border-b-2 border-neutral-900 text-neutral-900 font-medium' : 'text-neutral-500 hover:text-neutral-700'")
                                span 작업이력
                            button(class="flex-1 py-2.5 text-sm transition-colors -mb-px", (click)="initMessage('favorite')", [ngClass]="cache.messageTab == 'favorite' ? 'border-b-2 border-neutral-900 text-neutral-900 font-medium' : 'text-neutral-500 hover:text-neutral-700'")
                                span 중요메시지
                            button(class="flex-1 py-2.5 text-sm transition-colors -mb-px", (click)="initMessage('file')", [ngClass]="cache.messageTab == 'file' ? 'border-b-2 border-neutral-900 text-neutral-900 font-medium' : 'text-neutral-500 hover:text-neutral-700'")
                                span 파일

                        //- 메시지 목록
                        div(class="flex-1 flex flex-col overflow-hidden")
                            div(class="p-4 flex-1 relative text-sm overflow-auto bg-neutral-50/50")
                                ng-container(*ngIf="cache.newMessage")
                                    div(class="w-4/5 p-2.5 text-center text-sm rounded-lg bg-blue-50 text-blue-600 border border-blue-200 absolute left-[10%] bottom-3 z-[9999] cursor-pointer", (click)="unreadMessage(true)") 새로운 메시지가 있습니다

                                div('#messages'='', (scroll)="onScrollMessage()")
                                    ng-container(*ngIf="data.messages.length > 0")
                                        div(class="mx-auto mb-4 p-2.5 text-center rounded-lg bg-neutral-100 text-neutral-500 text-xs w-4/5", *ngIf="cache.isLastMessage") 모든 메시지를 확인하였습니다
                                        div(class="mt-5 mb-4", *ngIf="!cache.isLastMessage")

                                    div(class="mx-auto mb-4 p-2.5 text-center rounded-lg bg-neutral-100 text-neutral-500 text-xs", *ngIf="data.messages.length > 0 && cache.loadMessage") 메시지를 불러오고 있습니다

                                    ng-container(*ngIf="data.messages.length == 0 && cache.isLastMessage")
                                        div(class="mx-auto mb-4 p-2.5 text-center rounded-lg bg-neutral-100 text-neutral-500 text-xs w-4/5", *ngIf="cache.messageTab == 'message'") 메시지가 없습니다
                                        div(class="mx-auto mb-4 p-2.5 text-center rounded-lg bg-neutral-100 text-neutral-500 text-xs w-4/5", *ngIf="cache.messageTab == 'log'") 작업이력이 없습니다
                                        div(class="mx-auto mb-4 p-2.5 text-center rounded-lg bg-neutral-100 text-neutral-500 text-xs w-4/5", *ngIf="cache.messageTab == 'favorite'") 중요메시지가 없습니다
                                        div(class="mx-auto mb-4 p-2.5 text-center rounded-lg bg-neutral-100 text-neutral-500 text-xs w-4/5", *ngIf="cache.messageTab == 'file'") 파일이 없습니다

                                    ng-container(*ngFor="let msg of data.messages")
                                        div(class="flex items-end relative", [class.justify-end]="service.auth.session.id == msg.user_id")
                                            div(class="mr-2 mb-3", *ngIf="service.auth.session.id != msg.user_id")
                                                div(class="ml-2 flex items-center justify-center size-9 border border-blue-200 bg-blue-50 rounded-lg bg-contain bg-center bg-cover bg-no-repeat", style="background-image: url({{project.member.map[msg.user_id].profile_image}})", *ngIf="msg.type == 'message' || msg.type == 'file'")
                                                    span(class="font-medium text-blue-600 text-sm", *ngIf="!project.member.map[msg.user_id].profile_image") {{project.member.map[msg.user_id].name[0]}}
                                                div(class="ml-2 flex items-center justify-center size-9 border border-neutral-200 bg-neutral-100 rounded-lg", *ngIf="msg.type == 'log'")
                                                    i(class="ti ti-history text-neutral-500")

                                            div(class="flex flex-col bg-white mb-4 rounded-xl w-[70%] divide-y divide-neutral-100 overflow-hidden", [ngClass]="(cache.message.parent_id == msg.id ? 'ring-2 ring-blue-400' : 'border border-neutral-200') + ' ' + (service.auth.session.id == msg.user_id ? 'rounded-br-none' : 'rounded-bl-none')")
                                                wiz-portal-works-message-body([event]="messageEvent", [project]="project", [msg]="msg", [cache]="cache")
                                                ng-container(*ngFor="let reply of msg.reply")
                                                    wiz-portal-works-message-body([event]="messageEvent", [project]="project", [msg]="reply", [cache]="cache")

                                            div(class="ml-2 mb-3", *ngIf="service.auth.session.id == msg.user_id")
                                                div(class="flex items-center justify-center size-9 border border-neutral-200 bg-neutral-100 rounded-lg bg-contain bg-center bg-cover bg-no-repeat", style="background-image: url({{project.member.map[msg.user_id].profile_image}})", *ngIf="msg.type == 'message' || msg.type == 'file'")
                                                    span(class="font-medium text-neutral-600 text-sm", *ngIf="!project.member.map[msg.user_id].profile_image") {{project.member.map[msg.user_id].name[0]}}
                                                div(class="flex items-center justify-center size-9 border border-neutral-200 bg-neutral-100 rounded-lg", *ngIf="msg.type == 'log'")
                                                    i(class="ti ti-history text-neutral-500")

                            //- 답글 표시
                            div(class="flex items-center px-3 py-2 bg-neutral-50 border-t border-neutral-200 text-sm text-neutral-500", *ngIf="cache.message.parent_id")
                                span 답글을 작성하고 있습니다
                                div(class="ml-auto")
                                i(class="ti ti-x cursor-pointer text-neutral-400 hover:text-neutral-600 transition-colors", (click)="replyMessage()")

                            //- 첨부파일
                            div(class="px-3 py-2 bg-white border-t border-neutral-200", *ngIf="(cache.message.attachment && cache.message.attachment.length > 0) || cache.message.uploading")
                                ng-container(*ngFor="let file of cache.message.attachment")
                                    button(class="inline-flex items-center gap-1 text-xs border border-neutral-200 rounded-md mx-1 px-2 py-1 hover:border-neutral-300 transition-colors", (click)="removeAttachment(file)")
                                        span(class="font-medium") {{file.filename}}
                                        i(class="ti ti-x text-sm text-red-400")

                                button(class="inline-flex items-center text-xs bg-neutral-100 text-neutral-600 rounded-md px-2 py-1", *ngIf="cache.message.uploading")
                                    span {{cache.message.uploading.total}} 중 {{cache.message.uploading.index}} 번째 파일 업로드 중 ({{cache.message.uploading.process | number: '1.0-2'}}%)

                            //- 이미지 첨부
                            div(class="border-t border-neutral-200 bg-white", *ngIf="cache.message.images && cache.message.images.length > 0")
                                div(class="flex flex-wrap p-0 m-0")
                                    div(class="p-0 m-0 w-1/4", *ngFor="let image of cache.message.images")
                                        div(class="relative w-full bg-center bg-no-repeat bg-cover cursor-pointer hover:ring-2 hover:ring-blue-400", [style.background-image]="imageUrl(image)")
                                            svg(viewBox="0 0 100 100")
                                                rect(width="100", height="100", style="fill:rgba(255,255,255,0);")
                                            div(class="absolute top-1 right-1 size-6 flex items-center justify-center bg-red-500 text-white rounded-md cursor-pointer hover:bg-red-600 transition-colors", (click)="removeImage(image)")
                                                i(class="ti ti-x text-sm")

                            //- 메시지 작성
                            div(class="min-h-44 bg-white border-t border-neutral-200 p-3", *ngIf="!readOnly")
                                div(class="ck-editor-small ck-editor-works height-sm prose max-w-full")
                                    textarea('#comment'='', [namespace]="NAMESPACE")
                                div(class="flex items-center mt-2 gap-1")
                                    button(class="inline-flex items-center gap-1 px-2.5 py-1.5 text-xs bg-neutral-100 text-neutral-600 rounded-md hover:bg-neutral-200 transition-colors", (click)="upload('image')")
                                        i(class="ti ti-photo text-sm")
                                        span 이미지
                                    button(class="inline-flex items-center gap-1 px-2.5 py-1.5 text-xs bg-neutral-100 text-neutral-600 rounded-md hover:bg-neutral-200 transition-colors", (click)="upload('file')")
                                        i(class="ti ti-paperclip text-sm")
                                        span 파일
                                    div(class="ml-auto")
                                    button(class="inline-flex items-center gap-1 px-2.5 py-1.5 text-xs bg-neutral-100 text-neutral-600 rounded-md hover:bg-neutral-200 transition-colors", (click)="replyMessage()", *ngIf="cache.message.parent_id")
                                        span 취소
                                        i(class="ti ti-x text-sm")
                                    button(class="inline-flex items-center gap-1 px-3 py-1.5 text-xs bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors", (click)="sendMessage()")
                                        span(*ngIf="cache.message.parent_id") 답글달기
                                        span(*ngIf="!cache.message.parent_id") 보내기
                                        i(class="ti ti-send text-sm")

ng-keyboard-shortcuts([shortcuts]="shortcuts")
